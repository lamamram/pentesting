from socket import *

# création d'une socket réseau (AF_INET) 
# utilisant le protocole de transport TCP connecté (SOCK_STREAM)
s = socket(family=AF_INET, type=SOCK_STREAM)

# client de connexion
# URL = "www.wellho.net"
URL = "www.google.com"
PORT = 80
# schémar url
# ------ réseau ---------- système -------- data ------------
# proto://domain.name:port/path/to/resource?query=string#hash


try:
    # tip: on préfèrera accéder à l'ip plutôt que le nom de domaine
    ip = gethostbyname(URL)
    print(f" ip: {ip}")
    s.connect((ip, PORT))
    # s.connect((URL, PORT))
except gaierror as e:
    print(f"Unable to connect to {URL}: {e}")


# envoi d'une requête http de type GET sur le chemin /robots.txt
get = f"GET /robots.txt HTTP/1.1\r\nHost: {URL}\r\n\r\n"

# envoi de la requête http à travers le socket client
# on envoie les données sous forme d'octet
raw = bytes(get, "utf-8")

# send retourne le nombre d'octet envoyé
# send ne garantie pas que l'ensemble des octets a été envoyé
bytes_sent = s.send(raw)
print(f"envoi de {bytes_sent} octets")


# réception de la réponse http du serveur distant
while True:
    raw_data = s.recv(2048)
    if raw_data == b'':
        break
    # affichage de la chaine de caractère utf8 correspondante
    print(raw_data.decode("utf-8"))

s.close()