from boofuzz import *

URL = "192.168.1.44"
PORT = 21

def fuzz():
    # 1. création d'une session
    # déclaration de la cible via une connexion socket tcp
    session = Session(
       target=Target(
            connection=TCPSocketConnection(URL, PORT)
       ) 
    )

    # 2. créer les séquences d'envoi de commandes
    # authentification: USER puis PASS
    # création d'un fichier STOR
    # récupération du contenu d'un fichier RETR

    # demande de login : USER matt
    s_initialize(name="user")
    # fuzzable=False => la valeur ne subit pas de mutation
    s_string("USER", fuzzable=False)
    s_delim(" ")
    # subit des mutations
    s_string("anonymous", fuzzable=False)
    # ne subit pas de mutations
    s_static("\r\n")

    # demande de mdp : PASS pass
    s_initialize(name="pass")
    s_string("PASS", fuzzable=False)
    s_delim(" ")
    s_string("", fuzzable=False)
    s_static("\r\n")

    # création fichier
    s_initialize("stor")
    s_string("STOR", fuzzable=False)
    s_delim(" ")
    s_string("AAAA")
    s_static("\r\n")

    # lecture fichier
    s_initialize("retr")
    s_string("RETR", fuzzable=False)
    s_delim(" ")
    s_string("AAAA")
    s_static("\r\n")

    # 3. ordre d'enchainement des commandes
    session.connect(s_get("user"))
    session.connect(s_get("user"), s_get("pass"))
    session.connect(s_get("pass"), s_get("stor"))
    session.connect(s_get("pass"), s_get("retr"))

    session.fuzz()

if __name__ == "__main__":
    # serveur dispo sur localhost:26000
    # BUT: détecter un crash ou un comportement aberrant
    # conséquence: écriture d'un exploit basé sur les envois
    # responsables du crash
    fuzz()