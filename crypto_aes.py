#pip install pycryptodome
import base64
from Crypto.Cipher import AES
from Crypto import Random

key = "my key"
message = "this is my secret message"

# s'assurer que la clé est une longueur minimale
def pad(value, nb):
    l = len(value)
    if l % nb != 0:
        value += "\0" * (nb - l)
    return value

def encrypt(msg, key):
    msg = pad(msg, 32).encode("utf-8")
    # vecteur d'initialisition randomisé de la taille d'un bloc AES
    iv = Random.new().read(AES.block_size)
    cipher = AES.new(key.encode("utf-8"), AES.MODE_CBC, iv)
    # on transmet le vecteur d'initialisation pour déchiffrement
    return base64.b64encode(iv + cipher.encrypt(msg)).decode("utf-8")

def decrypt(ciphered, key):
    ciphered = base64.b64decode(ciphered)
    iv = ciphered[:16]
    cipher = AES.new(key.encode("utf-8"), AES.MODE_CBC, iv)
    return cipher.decrypt(ciphered[16:]).decode("utf-8")

if __name__ == "__main__":
    key = pad(key, 16)
    ciphered = encrypt(message, key)
    clear = decrypt(ciphered, key)
    print(clear)
